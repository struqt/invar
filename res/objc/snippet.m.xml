<?xml version="1.0" encoding="UTF-8"?>
<tns:root
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="invar.template ../snippet.xsd" xmlns:tns="invar.template" language="objc">

  <export resPath="objc/DataReader.m" destDir="" destName="DataReader.m"/>
  <export resPath="objc/DataWriter.m" destDir="" destName="DataWriter.m"/>

  <!-- Redefine 14 Invar buildin types to adapt Objective-C language -->
  <redefine genericOverride="true"/>

  <!-- Settings -->
  <template key="trace.all.types">     <![CDATA[ false ]]></template>
  <template key="unique.type.name">    <![CDATA[ true  ]]></template>
  <template key="one.pack.one.file">   <![CDATA[ false ]]></template>
  <template key="include.self">        <![CDATA[ false ]]></template>
  <template key="code.dir.prefix">     <![CDATA[  ]]></template>

  <template key="include.self">        <![CDATA[ true  ]]></template>
  <template key="pack.name.nested">    <![CDATA[ true  ]]></template>
  <template key="code.dir.flatten">    <![CDATA[ true ]]></template>
  <template key="file.name.lowercase"> <![CDATA[ false ]]></template>
  <template key="method.indent.num">   <![CDATA[ 0     ]]></template>

  <template key="refer.copy">    <![CDATA[(#name) = (#arg);]]></template>
  <template key="refer.const">   <![CDATA[const]]></template>
  <template key="pointer.null">  <![CDATA[ nil ]]></template>
  <template key="pointer.copy">  <![CDATA[CheckSet< (#type) > ((#name), (#arg));]]></template>
  <template key="byte.yes">    <![CDATA[static_cast<int8_t>(0x01)]]></template>
  <template key="byte.non">    <![CDATA[static_cast<int8_t>(0x00)]]></template>

  <template key="init.any">   <![CDATA[ (#deft)    ]]></template>
  <template key="init.int64"> <![CDATA[ (#deft)L   ]]></template>
  <template key="init.uint64"><![CDATA[ (#deft)UL  ]]></template>
  <template key="init.float"> <![CDATA[ (#deft)F   ]]></template>
  <template key="init.enum">  <![CDATA[ (#name)    ]]></template>
  <template key="init.string"><![CDATA[ @"(#deft)" ]]></template>
  <template key="init.struct"><![CDATA[ [[(#type) alloc] init] ]]></template>
  <template key="init.vec">   <![CDATA[ [[NSMutableArray alloc] init] ]]></template>
  <template key="init.map">   <![CDATA[ [[NSMutableDictionary alloc] init] ]]></template>

  <template key="file"><![CDATA[
	//*==---------------------------*  Obj-C  *--------------------------------===//
	//
	//             THIS FILE IS GENERATED BY INVAR. DO NOT EDIT !!!
	//
	//===----------------------------------------------------------------------==*//
	(#blank)
	(#includes)
	(#pack)
	]]></template>
  <template key="file.include"><![CDATA[ #import "(#name)"(#brk) ]]></template>
  <template key="file.pack"><![CDATA[ (#body) ]]></template>
  <template key="file.body"><![CDATA[
	(#blank)
	(#structs)]]></template>

  <!-- Common snippet -->
  <template key="doc">         <![CDATA[/* (#doc). */]]></template>
  <template key="doc.line">    <![CDATA[// (#doc).]]></template>

  <template key="import">      <![CDATA[ ]]></template>
  <template key="import.body"> <![CDATA[ ]]></template>
  <template key="import.split"><![CDATA[ :: ]]></template>

  <template key="code.invoker"><![CDATA[.]]></template>
  <template key="code.assignment"><![CDATA[(#type)(#name) = (#value);(#brk)]]></template>
  <template key="code.definition"><![CDATA[(#type)(#name);(#brk)]]></template>
  <template key="ptr.mark.string | ptr.mark.vec |
                 ptr.mark.struct | ptr.mark.map"><![CDATA[ * ]]></template>

  <template key="struct.meta"><![CDATA[ /* (#name) (#type) */ ]]></template>
  <template key="struct.field.self"><![CDATA[ & ]]></template>
  <template key="struct.field.prefix"><![CDATA[ _ ]]></template>
  <template key="struct.field"><![CDATA[
	  (#tab)[#clampLen(lenFieldType; 64; (#type) )] (#mark)
	  (#concat) [#clampLen(lenFieldName; 32; (#name) )];
	  (#concat) [#codeMetaData(fields; (#index))]
	]]></template>
  <template key="struct.field.del"><![CDATA[
    (#brk)(#tab)if ((#name) != (#null)) {
    (#tab)(#tab)delete (#name);
    (#tab)(#tab)(#name) = (#null);
    (#tab)}]]></template>
  <template key="struct"><![CDATA[
    [#addImport(struct; imports; ::DataWriter)]
    [#addImport(struct; imports; ::DataReader)]
    @interface (#name) ()
    {
    [#codeFields(struct; fields)]}
    @end
    (#blank)
    @implementation (#name)
    (#blank)
    static const uint32_t CRC32 = 0x[#codeCRC32(struct)];
    (#blank)
    [#codeNested (ctor.;  useFullName; struct; fields; imports)](#brk)
    [#codeGetters(struct; fields)]
    (#blank)
    [#codeSetters(struct; fields)]
    @end /* @implementation (#name) */
	]]></template>

  <template key="struct.getter"><![CDATA[
    - ([#clampLen(lenFieldType; 64; (#type) )] (#mark))
    (#concat) [#clampLen(lenFieldNameR; 32; (#namer) )] {
    (#concat) return [#clampLen(lenFieldName; 32; (#name) )]; }
  ]]></template>
  <template key="struct.setter"><![CDATA[
    - ((#typeupper) *) set[#clampLen(lenFieldName; 24; [#upperHeadChar( (#namer) )] )]
    (#concat):([#clampLen(lenFieldType; 64; (#type) )] (#mark))v
    (#concat) { [#clampLen(lenFieldName; 32; (#name) )] = v;
    (#concat) return self;
    (#concat) }
  ]]></template>

  <!-- Method Construct -->
  <template key="ctor.method"><![CDATA[
    - (instancetype) init
    {
    (#tab)self = [super init];
    (#tab)if (!self) { return self; }(#body)
    (#tab)return self;
    }
    /* End of init */
  ]]></template>
  <template key="ctor.any | ctor.vec | ctor.map"><![CDATA[
    [#clampLen(lenFieldName; 24; (#name))] = (#deft) ]]></template>
  <template key="ctor.ptr.any"><![CDATA[
    [#clampLen(lenFieldName; 24; (#name))] = (#null); ]]></template>
  <template key="ctor.ref.any"><![CDATA[ (#body); ]]></template>


</tns:root>